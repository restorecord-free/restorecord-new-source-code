// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = "mysql://restorecord_db:CFpsuJyCN5jQE7@localhost:3306/rest_main"

    // url      = "file:./database.db"
}

model accounts {
    id             Int          @id @default(autoincrement())
    username       String       @unique @db.VarChar(255)
    email          String       @db.LongText()
    password       String       @db.LongText()
    role           String?      @default("free")
    pfp            String       @default("https://cdn.restorecord.com/logo512.png")
    banned         Boolean      @default(false)
    twoFactor      Boolean      @default(false)
    googleAuthCode String?
    darkmode       Boolean      @default(true)
    expiry         DateTime?
    admin          Boolean      @default(false)
    lastIp         String?
    createdAt      DateTime     @default(now())
    userId         BigInt?      @db.UnsignedBigInt
    servers        servers[]
    customBots     customBots[]
}

model servers {
    id          Int        @id @default(autoincrement())
    name        String     @unique
    owner       accounts   @relation(fields: [ownerId], references: [id])
    ownerId     Int
    guildId     BigInt     @unique @db.UnsignedBigInt
    roleId      BigInt     @unique @db.UnsignedBigInt
    redirectUrl String?
    picture     String?    @default("https://i.imgur.com/w65Dpnw.png")
    vpncheck    Boolean    @default(false)
    webhook     String?
    bgImage     String?
    description String     @default("Just a Discord Server.")
    createdAt   DateTime   @default(now())
    customBot   customBots @relation(fields: [customBotId], references: [id])
    customBotId Int
    pulling     Boolean    @default(false)
    pullTimeout DateTime?  @default(now())
    members     members[]
}

model errors {
    id        Int      @id @default(autoincrement())
    code      String   @unique
    message   String   @db.LongText()
    createdAt DateTime @default(now())
}

model sessions {
    id        Int      @id @default(autoincrement())
    token     String   @unique @db.VarChar(999)
    accountId Int
    createdAt DateTime @default(now())
}

model members {
    id           Int      @id @default(autoincrement())
    userId       BigInt   @db.UnsignedBigInt
    guild        servers  @relation(fields: [guildId], references: [guildId])
    guildId      BigInt   @db.UnsignedBigInt
    accessToken  String
    refreshToken String
    ip           String?
    username     String
    avatar       String
    createdAt    DateTime @default(now())

    @@index([userId, guildId])
}

model customBots {
    id        Int       @id @default(autoincrement())
    name      String
    clientId  BigInt    @unique @db.UnsignedBigInt
    botToken  String
    botSecret String
    ownerId   Int
    owner     accounts  @relation(fields: [ownerId], references: [id])
    servers   servers[]
}

model news {
    id        Int      @id @default(autoincrement())
    title     String   @db.LongText
    content   String   @db.LongText
    author    String
    createdAt DateTime @default(now())
}
